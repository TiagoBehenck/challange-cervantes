-- Table: public.logged_actions

-- DROP TABLE public.logged_actions;

CREATE TABLE public.logged_actions
(
    schema_name text COLLATE pg_catalog."default" NOT NULL,
    table_name text COLLATE pg_catalog."default" NOT NULL,
    user_name text COLLATE pg_catalog."default",
    action_tstamp timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    action text COLLATE pg_catalog."default" NOT NULL,
    original_data text COLLATE pg_catalog."default",
    new_data text COLLATE pg_catalog."default",
    query text COLLATE pg_catalog."default",
    CONSTRAINT logged_actions_action_check CHECK (action = ANY (ARRAY['I'::text, 'D'::text, 'U'::text]))
)

WITH (
    FILLFACTOR = 100,
    autovacuum_enabled = FALSE
)
TABLESPACE pg_default;

ALTER TABLE public.logged_actions
    OWNER to postgres;

GRANT ALL ON TABLE public.logged_actions TO postgres;

GRANT SELECT ON TABLE public.logged_actions TO PUBLIC;

-- Index: logged_actions_action_idx

-- DROP INDEX public.logged_actions_action_idx;

CREATE INDEX logged_actions_action_idx
    ON public.logged_actions USING btree
    (action COLLATE pg_catalog."default" ASC NULLS LAST)
    TABLESPACE pg_default;


-- Index: logged_actions_action_tstamp_idx

-- DROP INDEX public.logged_actions_action_tstamp_idx;

CREATE INDEX logged_actions_action_tstamp_idx
    ON public.logged_actions USING btree
    (action_tstamp ASC NULLS LAST)
    TABLESPACE pg_default;


-- Index: logged_actions_schema_table_idx

-- DROP INDEX public.logged_actions_schema_table_idx;

CREATE INDEX logged_actions_schema_table_idx
    ON public.logged_actions USING btree
    (((schema_name || '.'::text) || table_name) COLLATE pg_catalog."default" ASC NULLS LAST)
    TABLESPACE pg_default;


public,estudantes,postgres,2020-02-10 14:10:10.377497-03,I,,"(6,Frida,24)","CREATE TRIGGER t_if_modified_trg 
AFTER INSERT OR UPDATE OR DELETE ON estudantes
FOR EACH ROW EXECUTE PROCEDURE if_modified_func();

SELECT * FROM logged_actions;
 
INSERT INTO estudantes (nome, id_number) VALUES (''Frida'', 24);
 
SELECT * FROM logged_actions;
 
 SHOW timezone;
 SET timezone = ''UTC'';
 SELECT * FROM logged_actions;
 RESET timezone;
 SELECT *, action_tstamp AT TIME ZONE ''UTC'' AS action_tstamp_utc FROM logged_actions;
"
public,estudantes,postgres,2020-02-10 14:10:38.763649-03,I,,"(7,Juno,35)","
INSERT INTO estudantes (nome, id_number) VALUES (''Juno'', 35);
 "
public,estudantes,postgres,2020-02-10 14:14:32.125064-03,I,,"(8,Teste,0)","
INSERT INTO estudantes (nome, id_number) VALUES (''Teste'', 0);
 "
